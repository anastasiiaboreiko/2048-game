var t,e={};const s=new((t=class{constructor(t){this.initialState=t?t.map(t=>t.slice()):Array.from({length:4},()=>[,,,,].fill(0)),this.board=this.initialState.map(t=>t.slice()),this.score=0,this.status="idle"}moveLeft(){if("playing"!==this.status)return;let t=this.board.map(t=>t.slice());this.board=this.board.map(t=>{let e=0,s=t.filter(t=>0!==t);for(let t=0;t<s.length-1;t++)s[t]===s[t+1]&&(s[t]*=2,s[t+1]=0,e+=s[t]);this.score+=e;let r=s.filter(t=>0!==t);for(;r.length<4;)r.push(0);return r}),this._isBoardChanged(this.board,t)&&this._addNewNumber(this.board),this._checkGameStatus()}moveRight(){if("playing"!==this.status)return;let t=this.board.map(t=>t.slice());this.board=this.board.map(t=>{let e=0,s=t.filter(t=>0!==t);for(let t=s.length-1;t>0;t--)s[t]===s[t-1]&&(s[t]*=2,s[t-1]=0,e+=s[t]);this.score+=e;let r=s.filter(t=>0!==t);for(;r.length<4;)r.unshift(0);return r}),this._isBoardChanged(this.board,t)&&this._addNewNumber(this.board),this._checkGameStatus()}moveUp(){if("playing"!==this.status)return;let t=this.board.map(t=>t.slice());for(let t=0;t<4;t++){let e=this.board.map(e=>e[t]),s=this._compress(e);this.score+=s.score;for(let e=0;e<4;e++)this.board[e][t]=s.column[e]}this._isBoardChanged(this.board,t)&&this._addNewNumber(this.board),this._checkGameStatus()}moveDown(){if("playing"!==this.status)return;let t=this.board.map(t=>t.slice());for(let t=0;t<4;t++){let e=this.board.map(e=>e[t]).reverse(),s=this._compress(e);this.score+=s.score;let r=s.column.reverse();for(let e=0;e<4;e++)this.board[e][t]=r[e]}this._isBoardChanged(this.board,t)&&this._addNewNumber(this.board),this._checkGameStatus()}getScore(){return this.score}getState(){return this.board.map(t=>t.slice())}getStatus(){return this.status}start(){"idle"!==this.status&&(this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status="idle"),this._getEmptyCells(this.board).length>=2&&(this._addNewNumber(this.board),this._addNewNumber(this.board)),this.status="playing"}restart(){this.board=this.initialState,this.score=0,this.status="idle"}_getRandomEmptyCell(t){let e=Math.floor(Math.random()*t.length);return t.splice(e,1)[0]}_compress(t){let e=[],s=0;for(let s=0;s<t.length;s++)0!==t[s]&&e.push(t[s]);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,s+=e[t]);let r=e.filter(t=>0!==t);for(;r.length<4;)r.push(0);return{column:r,score:s}}_getEmptyCells(t){let e=[];for(let s=0;s<4;s++)for(let r=0;r<4;r++)0===t[s][r]&&e.push([s,r]);return e}_isBoardFull(t){return 0===this._getEmptyCells(t).length}_isBoardChanged(t,e){return t.some((t,s)=>t.some((t,r)=>t!==e[s][r]))}_addNewNumber(t){let e=this._getEmptyCells(t),s=this._getRandomEmptyCell(e);if(s){let[e,r]=s;t[e][r]=.9>Math.random()?2:4}}_checkGameStatus(){let t=this.board.flat();if(t.includes(2048)){this.status="win";return}if(!t.includes(0)){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.board[t][e];if(e<3&&s===this.board[t][e+1]||t<3&&s===this.board[t+1][e])return}this.status="lose"}}}).__esModule?t.default:t),r=document.querySelector(".start");function i(t){let e=document.querySelectorAll(".field-cell"),s=0;for(let r=0;r<4;r++)for(let i=0;i<4;i++){let a=t[r][i],l=e[s];l.textContent=0===a?"":a,l.className="field-cell",0!==a&&l.classList.add(`field-cell--${a}`),s++}}function a(t){let e=document.querySelector(".message-start"),s=document.querySelector(".message-win"),r=document.querySelector(".message-lose");switch(e.classList.add("hidden"),s.classList.add("hidden"),r.classList.add("hidden"),t){case"idle":e.classList.remove("hidden");break;case"win":s.classList.remove("hidden");break;case"lose":r.classList.remove("hidden")}}r.addEventListener("click",()=>{s.start(),i(s.getState()),r.className="button restart",r.textContent="Restart",a(s.getStatus())}),document.addEventListener("keydown",t=>{var e;switch(t.key){case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight()}i(s.getState()),e=s.getScore(),document.querySelector(".game-score").textContent=e,a(s.getStatus())});
//# sourceMappingURL=index.4582e200.js.map
